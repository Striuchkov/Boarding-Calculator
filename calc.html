<!DOCTYPE html>
<html>
  <head>
    <title>Dog Boarding Calculator</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
      }
      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
      }
      .booking-section {
        border: 1px solid #ddd;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 5px;
        background-color: #f9f9f9;
      }
      .booking-title {
        margin-top: 0;
        padding-bottom: 10px;
        border-bottom: 1px solid #ddd;
      }
      .results-section {
        margin-top: 20px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #f5f5f5;
      }
      .booking-result {
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid #ddd;
      }
      .info-box {
        background-color: #e8f4ff;
        border: 1px solid #b8daff;
        padding: 10px;
        margin-bottom: 20px;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <h2>Dog Boarding Cost Calculator</h2>

    <div class="info-box">
      <p>
        <strong>Family Booking:</strong> This calculator allows you to book up
        to three different room types for your pets. Multi-pet discounts apply
        to all additional pets after the first pet, regardless of which room
        they're in.
      </p>
    </div>

    <div class="form-group">
      <label>Are you a member?</label>
      <select id="member">
        <option value="no">No</option>
        <option value="yes">Yes</option>
      </select>
    </div>

    <!-- Booking 1 -->
    <div class="booking-section">
      <h3 class="booking-title">Room 1</h3>
      <div class="form-group">
        <label>Number of pets (1-5):</label>
        <input type="number" id="numPets1" min="1" max="5" value="1" />
      </div>

      <div class="form-group">
        <label>Duration in days (1-35):</label>
        <input type="number" id="duration1" min="1" max="35" value="1" />
      </div>

      <div class="form-group">
        <label>Room arrangement:</label>
        <select id="roomType1">
          <option value="separate">Separate Rooms</option>
          <option value="shared">Shared Room</option>
        </select>
      </div>

      <div class="form-group">
        <label>Stay type:</label>
        <select id="stayType1">
          <option value="56">Bark 'n' Bunk Dormitory ($56)</option>
          <option value="80">Junior Suite ($80)</option>
          <option value="105">Grand Suite ($105)</option>
          <option value="126">Royal Suite ($126)</option>
        </select>
      </div>
    </div>

    <!-- Booking 2 -->
    <div class="booking-section">
      <h3 class="booking-title">Room 2 (Optional)</h3>
      <div class="form-group">
        <input
          type="checkbox"
          id="enableBooking2"
          onchange="toggleBookingSection(2)"
        />
        <label for="enableBooking2" style="display: inline">Add Room 2</label>
      </div>

      <div id="booking2Fields" style="display: none">
        <div class="form-group">
          <label>Number of pets (1-5):</label>
          <input type="number" id="numPets2" min="1" max="5" value="1" />
        </div>

        <div class="form-group">
          <label>Duration in days (1-35):</label>
          <input type="number" id="duration2" min="1" max="35" value="1" />
        </div>

        <div class="form-group">
          <label>Room arrangement:</label>
          <select id="roomType2">
            <option value="separate">Separate Rooms</option>
            <option value="shared">Shared Room</option>
          </select>
        </div>

        <div class="form-group">
          <label>Stay type:</label>
          <select id="stayType2">
            <option value="56">Bark 'n' Bunk Dormitory ($56)</option>
            <option value="80">Junior Suite ($80)</option>
            <option value="105">Grand Suite ($105)</option>
            <option value="126">Royal Suite ($126)</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Booking 3 -->
    <div class="booking-section">
      <h3 class="booking-title">Room 3 (Optional)</h3>
      <div class="form-group">
        <input
          type="checkbox"
          id="enableBooking3"
          onchange="toggleBookingSection(3)"
        />
        <label for="enableBooking3" style="display: inline">Add Room 3</label>
      </div>

      <div id="booking3Fields" style="display: none">
        <div class="form-group">
          <label>Number of pets (1-5):</label>
          <input type="number" id="numPets3" min="1" max="5" value="1" />
        </div>

        <div class="form-group">
          <label>Duration in days (1-35):</label>
          <input type="number" id="duration3" min="1" max="35" value="1" />
        </div>

        <div class="form-group">
          <label>Room arrangement:</label>
          <select id="roomType3">
            <option value="separate">Separate Rooms</option>
            <option value="shared">Shared Room</option>
          </select>
        </div>

        <div class="form-group">
          <label>Stay type:</label>
          <select id="stayType3">
            <option value="56">Bark 'n' Bunk Dormitory ($56)</option>
            <option value="80">Junior Suite ($80)</option>
            <option value="105">Grand Suite ($105)</option>
            <option value="126">Royal Suite ($126)</option>
          </select>
        </div>
      </div>
    </div>

    <button onclick="calculateCost()">Calculate Cost</button>

    <div id="result" class="results-section" style="display: none"></div>

    <script>
      function toggleBookingSection(bookingNum) {
        const fieldsDiv = document.getElementById(`booking${bookingNum}Fields`);
        const checkbox = document.getElementById(`enableBooking${bookingNum}`);
        fieldsDiv.style.display = checkbox.checked ? "block" : "none";
      }

      function calculateCost() {
        // Get membership status
        const isMember = document.getElementById("member").value === "yes";

        // Calculate total pet count across all bookings
        let totalPets = parseInt(document.getElementById("numPets1").value);

        // Array to store booking data
        const bookings = [
          {
            num: 1,
            enabled: true,
            numPets: totalPets,
            duration: parseInt(document.getElementById("duration1").value),
            roomType: document.getElementById("roomType1").value,
            baseRate: parseFloat(document.getElementById("stayType1").value),
          },
        ];

        // Add optional bookings if enabled
        if (document.getElementById("enableBooking2").checked) {
          const numPets2 = parseInt(document.getElementById("numPets2").value);
          totalPets += numPets2;

          bookings.push({
            num: 2,
            enabled: true,
            numPets: numPets2,
            duration: parseInt(document.getElementById("duration2").value),
            roomType: document.getElementById("roomType2").value,
            baseRate: parseFloat(document.getElementById("stayType2").value),
          });
        }

        if (document.getElementById("enableBooking3").checked) {
          const numPets3 = parseInt(document.getElementById("numPets3").value);
          totalPets += numPets3;

          bookings.push({
            num: 3,
            enabled: true,
            numPets: numPets3,
            duration: parseInt(document.getElementById("duration3").value),
            roomType: document.getElementById("roomType3").value,
            baseRate: parseFloat(document.getElementById("stayType3").value),
          });
        }

        // Calculate costs for each booking
        let totalBaseCost = 0;
        let totalDiscount = 0;
        let totalAfterDiscount = 0;
        let memberDiscount = 0;
        let finalCost = 0;

        // First, calculate base costs for all bookings
        bookings.forEach((booking) => {
          booking.baseCost =
            booking.baseRate * booking.numPets * booking.duration;
          totalBaseCost += booking.baseCost;
        });

        // Get flat array of all pets for discount calculation
        let allPets = [];
        let petId = 0;

        bookings.forEach((booking) => {
          for (let i = 0; i < booking.numPets; i++) {
            // Calculate stay discount for this specific pet based on its duration
            let stayDiscountRate = 0;
            let stayDiscountType = "";

            if (booking.duration >= 30) {
              stayDiscountRate = 0.2;
              stayDiscountType = "20% Extended Stay (30+ nights)";
            } else if (booking.duration >= 7) {
              stayDiscountRate = 0.1;
              stayDiscountType = "10% Extended Stay (7+ nights)";
            }

            allPets.push({
              id: petId++, // Unique ID for each pet
              roomNum: booking.num,
              baseRate: booking.baseRate,
              duration: booking.duration,
              roomType: booking.roomType,
              stayDiscountRate: stayDiscountRate,
              stayDiscountType: stayDiscountType,
              isFirstPet: allPets.length === 0, // First pet across all rooms
              isFirstInRoom: i === 0, // First pet in this specific room
            });
          }
        });

        // Process room-by-room calculations
        const bookingResults = bookings.map((booking) => {
          const result = { ...booking };

          // Find pets in this room
          const petsInRoom = allPets.filter(
            (pet) => pet.roomNum === booking.num
          );

          // Count first vs additional pets
          const firstPetInRoom = petsInRoom.find((pet) => pet.isFirstPet);

          // Get additional pets (those that aren't the first pet in the entire booking)
          const additionalPetsAcrossRooms = petsInRoom.filter(
            (pet) => !pet.isFirstPet
          );

          // Set up results for display
          result.hasFirstPet = !!firstPetInRoom;
          result.additionalPetCount = additionalPetsAcrossRooms.length;

          // Calculate room costs and discounts
          result.firstPetCost = 0;
          result.additionalPetsCost = 0;
          result.appliedDiscount = 0;
          result.discountTypes = new Set();

          // Process first pet (if in this room)
          if (firstPetInRoom) {
            result.firstPetCost =
              firstPetInRoom.baseRate * firstPetInRoom.duration;

            // Apply stay discount to first pet if applicable
            if (firstPetInRoom.stayDiscountRate > 0) {
              const discount =
                result.firstPetCost * firstPetInRoom.stayDiscountRate;
              result.appliedDiscount += discount;
              result.discountTypes.add(firstPetInRoom.stayDiscountType);
            }
          }

          // Process additional pets
          additionalPetsAcrossRooms.forEach((pet) => {
            const petBaseCost = pet.baseRate * pet.duration;
            result.additionalPetsCost += petBaseCost;

            // Determine multi-pet discount based on pet's position
            let roomMultiPetDiscountRate;
            let roomMultiPetDiscountType;

            // Only apply 20% discount to additional pets in shared rooms
            if (pet.roomType === "shared" && !pet.isFirstInRoom) {
              roomMultiPetDiscountRate = 0.2;
              roomMultiPetDiscountType = "20% Multi-Pet (Shared Room)";
            } else {
              roomMultiPetDiscountRate = 0.1;
              roomMultiPetDiscountType = "10% Multi-Pet (Separate Rooms)";
            }

            // Compare multi-pet discount vs stay discount
            const multiPetDiscount = petBaseCost * roomMultiPetDiscountRate;
            const stayDiscount =
              pet.stayDiscountRate > 0 ? petBaseCost * pet.stayDiscountRate : 0;

            if (stayDiscount > multiPetDiscount && pet.stayDiscountRate > 0) {
              result.appliedDiscount += stayDiscount;
              result.discountTypes.add(pet.stayDiscountType);
            } else if (roomMultiPetDiscountRate > 0) {
              result.appliedDiscount += multiPetDiscount;
              result.discountTypes.add(roomMultiPetDiscountType);
            }
          });

          // Format discount type for display
          if (result.discountTypes.size === 1) {
            result.discountType = Array.from(result.discountTypes)[0];
          } else if (result.discountTypes.size > 1) {
            result.discountType = "Multiple Discounts Applied";
          } else {
            result.discountType = "";
          }

          result.afterDiscount = result.baseCost - result.appliedDiscount;

          totalDiscount += result.appliedDiscount;
          totalAfterDiscount += result.afterDiscount;

          return result;
        });

        // Apply member discount if applicable
        if (isMember) {
          memberDiscount = totalAfterDiscount * 0.05;
          finalCost = totalAfterDiscount * 0.95;
        } else {
          finalCost = totalAfterDiscount;
        }

        // Generate HTML for results
        let resultHTML = `
      <h3>Cost Breakdown for Family Booking (${totalPets} pets total)</h3>
    `;

        // Add each booking detail
        bookingResults.forEach((booking) => {
          resultHTML += `
        <div class="booking-result">
          <h4>Room ${booking.num}</h4>
          <p>${booking.numPets} pet${booking.numPets > 1 ? "s" : ""} for ${
            booking.duration
          } day${booking.duration > 1 ? "s" : ""} (${
            booking.roomType === "shared" ? "Shared Room" : "Separate Rooms"
          })</p>
          
          ${
            booking.hasFirstPet
              ? `<p>First Pet: $${booking.firstPetCost.toFixed(2)}</p>`
              : ""
          }
          
          ${
            booking.additionalPetCount > 0
              ? `<p>${
                  booking.additionalPetCount > 1
                    ? "Additional Pets"
                    : "Additional Pet"
                }: $${booking.additionalPetsCost.toFixed(2)}</p>`
              : ""
          }
          
          ${
            booking.appliedDiscount > 0
              ? `<p>${
                  booking.discountType
                }: -$${booking.appliedDiscount.toFixed(2)}</p>`
              : ""
          }
          
          <p>Room Subtotal: $${booking.afterDiscount.toFixed(2)}</p>
        </div>
      `;
        });

        // Add discount details
        resultHTML += `
      <p>Total Base Cost: $${totalBaseCost.toFixed(2)}</p>
    `;

        if (totalDiscount > 0) {
          resultHTML += `<p>Total Discounts: -$${totalDiscount.toFixed(2)}</p>`;
        }

        if (isMember) {
          resultHTML += `<p>Member 5% Discount: -$${memberDiscount.toFixed(
            2
          )}</p>`;
        }

        resultHTML += `<p><strong>Final Total: $${finalCost.toFixed(
          2
        )}</strong></p>`;

        // Display result
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = resultHTML;
        resultDiv.style.display = "block";
      }
    </script>
  </body>
</html>
